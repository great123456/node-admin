/*! emomoBms 2017-02-10 */
exports.filterInit=function(a,b){function c(a){for(var b=a.originalUrl,c=e.urls,d=0;d<c.length;d++){var f=c[d];if(0==b.indexOf(f))return!0}return!1}var d=require("./utils"),e=b.filtersOption;a.use(function(a,b,c){e.select==e.type.backend&&"/"==a.originalUrl?b.redirect("/index"):c()}),a.use(function(a,b,f){if(e.select==e.type.backend)if(c(a))f();else if(e.isCheckRole===!0){var g=a.session.user,h=a.session.MEMBER_ROLE;if(void 0!=g&&null!=g&&void 0!=e.roles[h]){b.locals.USER_NICK_NAME=g.nickName,b.locals.USER_MENU=h,console.log("logioned"),k=a.originalUrl;var i=k.indexOf("?");i!=-1&&(k=k.substring(0,i)),console.log(k),d.contains(e.roles[h],k)?f():d.pageMessage(a,b,"你无此操作权限","/index","index","index")}else{console.log("no logion");var j=a.originalUrl,k="";k=void 0!=j&&null!=j&&""!=j?e.loginUrl+"?redirectUrl="+j:e.loginUrl,b.redirect(k)}}else b.locals.USER_NICK_NAME="",b.locals.USER_MENU="",f();else if(e.select==e.type.fortend)if(c(a)){var g=a.session;if(g.role="YUNKONG_PLATFORM_ADMIN",console.log("过滤器currentUser------------"+g),void 0!=g&&null!=g&&void 0!=e.roles[g.role])f();else{var j=a.originalUrl,k="";k=void 0!=j&&null!=j&&""!=j?e.loginUrl+"?redirectUrl="+j:e.loginUrl,b.redirect(k)}}else f();else f()})};