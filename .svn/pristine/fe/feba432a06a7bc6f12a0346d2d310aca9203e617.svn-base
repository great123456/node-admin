/*! emomoBms 2017-02-10 */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){a.cxSelect=function(b){var c,d,e,f={dom:{},api:{}},g=function(a){return!(!a||"function"!=typeof HTMLElement&&"object"!=typeof HTMLElement||!(a instanceof HTMLElement))||!(!a||!a.nodeType||1!==a.nodeType)},h=function(a){return!!(a&&a.length&&("function"==typeof jQuery||"object"==typeof jQuery)&&a instanceof jQuery)};for(d=0,e=arguments.length;e>d;d++)h(arguments[d])?c=arguments[d]:g(arguments[d])?c=a(arguments[d]):"object"==typeof arguments[d]&&(b=arguments[d]);if(!(c.length<1))return f.init=function(){var d,e=this;if(e.dom.box=c,e.settings=a.extend({},a.cxSelect.defaults,b,{url:e.dom.box.data("url"),nodata:e.dom.box.data("nodata"),required:e.dom.box.data("required"),firstTitle:e.dom.box.data("firstTitle"),firstValue:e.dom.box.data("firstValue")}),e.settings.selects.length){for(e.selectArray=[],e.selectSum=e.settings.selects.length,d=0;d<e.selectSum&&e.dom.box.find("select."+e.settings.selects[d]);d++)e.selectArray.push(e.dom.box.find("select."+e.settings.selects[d]));e.selectSum=e.selectArray.length,e.selectSum&&("string"==typeof e.settings.url?a.getJSON(e.settings.url,function(a){e.dataJson=a,e.buildContent()}):"object"==typeof e.settings.url&&(e.dataJson=e.settings.url,e.buildContent()))}},f.getIndex=function(a){return this.settings.required?a:a-1},f.getNewOptions=function(b,c){var d,e,f,g,h;if(b)return d=this.settings.firstTitle,e=this.settings.firstValue,f=b.data("firstTitle"),g=b.data("firstValue"),h="",("string"==typeof f||"number"==typeof f||"boolean"==typeof f)&&(d=f.toString()),("string"==typeof g||"number"==typeof g||"boolean"==typeof g)&&(e=g.toString()),this.settings.required||(h='<option value="'+e+'">'+d+"</option>"),a.each(c,function(a,b){h+="string"==typeof b.v||"number"==typeof b.v||"boolean"==typeof b.v?'<option value="'+b.v+'">'+b.n+"</option>":'<option value="'+b.n+'">'+b.n+"</option>"}),h},f.buildContent=function(){var a,b=this;b.dom.box.on("change","select",function(){b.selectChange(this.className)}),a=b.getNewOptions(b.selectArray[0],b.dataJson),b.selectArray[0].html(a).prop("disabled",!1).trigger("change"),b.setDefaultValue()},f.setDefaultValue=function(a){var b,c;a=a||0,b=this,a>=b.selectSum||!b.selectArray[a]||(c=b.selectArray[a].data("value"),("string"==typeof c||"number"==typeof c||"boolean"==typeof c)&&(c=c.toString(),setTimeout(function(){b.selectArray[a].val(c).trigger("change"),a++,b.setDefaultValue(a)},1)))},f.selectChange=function(a){var b,c,d,e,f,g;for(a=a.replace(/ /g,","),a=","+a+",",b=[],g=0;g<this.selectSum;g++)b.push(this.getIndex(this.selectArray[g].get(0).selectedIndex)),"number"==typeof c&&g>c&&(this.selectArray[g].empty().prop("disabled",!0),"none"===this.settings.nodata?this.selectArray[g].css("display","none"):"hidden"===this.settings.nodata&&this.selectArray[g].css("visibility","hidden")),a.indexOf(","+this.settings.selects[g]+",")>-1&&(c=g);for(d=c+1,e=this.dataJson,g=0;d>g;g++){if("undefined"==typeof e[b[g]]||Array.isArray(e[b[g]].s)===!1||!e[b[g]].s.length)return;e=e[b[g]].s}this.selectArray[d]&&(f=this.getNewOptions(this.selectArray[d],e),this.selectArray[d].html(f).prop("disabled",!1).css({display:"",visibility:""}).trigger("change"))},f.init(),this},a.cxSelect.defaults={selects:[],url:null,nodata:null,required:!1,firstTitle:"请选择",firstValue:"0"},a.fn.cxSelect=function(b,c){return this.each(function(){a.cxSelect(this,b,c)}),this}});