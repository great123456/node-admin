/*! emomoBms 2017-02-10 */
!function(a,b){var c="multiple"in document.createElement("INPUT"),d="FileList"in window,e="FileReader"in window,f="File"in window,g=function(b,c){var d=this;this.settings=a.extend({},a.fn.ace_file_input.defaults,c),this.$element=a(b),this.element=b,this.disabled=!1,this.can_reset=!0,this.$element.off("change.ace_inner_call").on("change.ace_inner_call",function(a,b){if(!d.disabled&&b!==!0)return i.call(d)});var e=this.$element.closest("label").css({display:"block"}),f=0==e.length?"label":"span";this.$element.wrap("<"+f+' class="ace-file-input" />'),this.apply_settings(),this.reset_input_field()};g.error={FILE_LOAD_FAILED:1,IMAGE_LOAD_FAILED:2,THUMBNAIL_FAILED:3},g.prototype.apply_settings=function(){var b=this;this.multi=this.$element.attr("multiple")&&c,this.well_style="well"==this.settings.style,this.well_style?this.$element.parent().addClass("ace-file-multiple"):this.$element.parent().removeClass("ace-file-multiple"),this.$element.parent().find(":not(input[type=file])").remove(),this.$element.after('<span class="ace-file-container" data-title="'+this.settings.btn_choose+'"><span class="ace-file-name" data-title="'+this.settings.no_file+'">'+(this.settings.no_icon?'<i class="'+ace.vars.icon+this.settings.no_icon+'"></i>':"")+"</span></span>"),this.$label=this.$element.next(),this.$container=this.$element.closest(".ace-file-input");var e=!!this.settings.icon_remove;if(e){var f=a('<a class="remove" href="#"><i class="'+ace.vars.icon+this.settings.icon_remove+'"></i></a>').appendTo(this.$element.parent());f.on(ace.click_event,function(a){if(a.preventDefault(),!b.can_reset)return!1;var c=!0;if(b.settings.before_remove&&(c=b.settings.before_remove.call(b.element)),!c)return!1;b.reset_input();return!1})}this.settings.droppable&&d&&h.call(this)},g.prototype.show_file_list=function(b){var c="undefined"==typeof b?this.$element.data("ace_input_files"):b;if(c&&0!=c.length){this.well_style&&(this.$label.find(".ace-file-name").remove(),this.settings.btn_change||this.$label.addClass("hide-placeholder")),this.$label.attr("data-title",this.settings.btn_change).addClass("selected");for(var d=0;d<c.length;d++){var f="string"==typeof c[d]?c[d]:a.trim(c[d].name),g=f.lastIndexOf("\\")+1;0==g&&(g=f.lastIndexOf("/")+1),f=f.substr(g);var h="fa fa-file",i="file";if(/\.(jpe?g|png|gif|svg|bmp|tiff?)$/i.test(f)?(h="fa fa-picture-o file-image",i="image"):/\.(mpe?g|flv|mov|avi|swf|mp4|mkv|webm|wmv|3gp)$/i.test(f)?(h="fa fa-film file-video",i="video"):/\.(mp3|ogg|wav|wma|amr|aac)$/i.test(f)&&(h="fa fa-music file-audio",i="audio"),this.well_style){this.$label.append('<span class="ace-file-name" data-title="'+f+'"><i class="'+ace.vars.icon+h+'"></i></span>');var k=a.trim(c[d].type),l=e&&this.settings.thumbnail&&(k.length>0&&k.match("image")||0==k.length&&"image"==i);if(l){var m=this;a.when(j.call(this,c[d])).fail(function(a){m.settings.preview_error&&m.settings.preview_error.call(m,f,a.code)})}}else this.$label.find(".ace-file-name").attr({"data-title":f}).find(ace.vars[".icon"]).attr("class",ace.vars.icon+h)}return!0}},g.prototype.reset_input=function(){this.reset_input_ui(),this.reset_input_field()},g.prototype.reset_input_ui=function(){this.$label.attr({"data-title":this.settings.btn_choose,class:"ace-file-container"}).find(".ace-file-name:first").attr({"data-title":this.settings.no_file,class:"ace-file-name"}).find(ace.vars[".icon"]).attr("class",ace.vars.icon+this.settings.no_icon).prev("img").remove(),this.settings.no_icon||this.$label.find(ace.vars[".icon"]).remove(),this.$label.find(".ace-file-name").not(":first").remove(),this.reset_input_data()},g.prototype.reset_input_field=function(){this.$element.wrap("<form>").parent().get(0).reset(),this.$element.unwrap()},g.prototype.reset_input_data=function(){this.$element.data("ace_input_files")&&(this.$element.removeData("ace_input_files"),this.$element.removeData("ace_input_method"))},g.prototype.enable_reset=function(a){this.can_reset=a},g.prototype.disable=function(){this.disabled=!0,this.$element.attr("disabled","disabled").addClass("disabled")},g.prototype.enable=function(){this.disabled=!1,this.$element.removeAttr("disabled").removeClass("disabled")},g.prototype.files=function(){return a(this).data("ace_input_files")||null},g.prototype.method=function(){return a(this).data("ace_input_method")||""},g.prototype.update_settings=function(b){this.settings=a.extend({},this.settings,b),this.apply_settings()},g.prototype.loading=function(b){if(b===!1)this.$container.find(".ace-file-overlay").remove(),this.element.removeAttribute("readonly");else{var c="string"==typeof b?b:'<i class="overlay-content fa fa-spin fa-spinner orange2 fa-2x"></i>',d=this.$container.find(".ace-file-overlay");0==d.length&&(d=a('<div class="ace-file-overlay"></div>').appendTo(this.$container),d.on("click tap",function(a){return a.stopImmediatePropagation(),a.preventDefault(),!1}),this.element.setAttribute("readonly","true")),d.empty().append(c)}};var h=function(){var a=this,b=this.$element.parent();b.off("dragenter").on("dragenter",function(a){a.preventDefault(),a.stopPropagation()}).off("dragover").on("dragover",function(a){a.preventDefault(),a.stopPropagation()}).off("drop").on("drop",function(b){if(b.preventDefault(),b.stopPropagation(),!a.disabled){var c=b.originalEvent.dataTransfer,d=c.files;if(!a.multi&&d.length>1){var e=[];e.push(d[0]),d=e}return d=l.call(a,d,!0),d!==!1&&(a.$element.data("ace_input_method","drop"),a.$element.data("ace_input_files",d),a.show_file_list(d),a.$element.triggerHandler("change",[!0]),!0)}})},i=function(){var a=this.element.files||[this.element.value];return a=l.call(this,a,!1),a!==!1&&(this.$element.data("ace_input_method","select"),this.$element.data("ace_input_files",a),this.show_file_list(a),!0)},j=function(b){var c=this,d=c.$label.find(".ace-file-name:last"),e=new a.Deferred,f=new FileReader;return f.onload=function(f){d.prepend("<img class='middle' style='display:none;' />");var h=d.find("img:last").get(0);a(h).one("load",function(){var f=50;"large"==c.settings.thumbnail?f=150:"fit"==c.settings.thumbnail&&(f=d.width()),d.addClass(f>50?"large":"");var i=k(h,f,b.type);if(null==i)return a(this).remove(),void e.reject({code:g.error.THUMBNAIL_FAILED});var j=i.w,l=i.h;"small"==c.settings.thumbnail&&(j=l=f),a(h).css({"background-image":"url("+i.src+")",width:j,height:l}).data("thumb",i.src).attr({src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="}).show(),e.resolve()}).one("error",function(){d.find("img").remove(),e.reject({code:g.error.IMAGE_LOAD_FAILED})}),h.src=f.target.result},f.onerror=function(a){e.reject({code:g.error.FILE_LOAD_FAILED})},f.readAsDataURL(b),e.promise()},k=function(b,c,d){var e=b.width,f=b.height;e=e>0?e:a(b).width(),f=f>0?f:a(b).height(),(e>c||f>c)&&(e>f?(f=parseInt(c/e*f),e=c):(e=parseInt(c/f*e),f=c));var g;try{var h=document.createElement("canvas");h.width=e,h.height=f;var i=h.getContext("2d");i.drawImage(b,0,0,b.width,b.height,0,0,e,f),g=h.toDataURL()}catch(a){g=null}return g?(/^data\:image\/(png|jpe?g|gif);base64,[0-9A-Za-z\+\/\=]+$/.test(g)||(g=null),g?{src:g,w:e,h:f}:null):null},l=function(a,b){var c=o.call(this,a,b);return c===-1?(this.reset_input(),!1):c&&0!=c.length?((c instanceof Array||d&&c instanceof FileList)&&(a=c),c=!0,this.settings.before_change&&(c=this.settings.before_change.call(this.element,a,b)),c===-1?(this.reset_input(),!1):c&&0!=c.length?((c instanceof Array||d&&c instanceof FileList)&&(a=c),a):(this.$element.data("ace_input_files")||this.reset_input(),!1)):(this.$element.data("ace_input_files")||this.reset_input(),!1)},m=function(a){return a?("string"==typeof a&&(a=[a]),0==a.length?null:new RegExp(".(?:"+a.join("|")+")$","i")):null},n=function(a){return a?("string"==typeof a&&(a=[a]),0==a.length?null:new RegExp("^(?:"+a.join("|").replace(/\//g,"\\/")+")$","i")):null},o=function(b,c){var d=m(this.settings.allowExt),e=m(this.settings.denyExt),g=n(this.settings.allowMime),h=n(this.settings.denyMime),i=this.settings.maxSize||!1;if(!(d||e||g||h||i))return!0;for(var j=[],k={},l=0;l<b.length;l++){var o=b[l],p=f?o.name:o;if(!d||d.test(p))if(e&&e.test(p))"ext"in k||(k.ext=[]),k.ext.push(p);else{var q;if(f){if((q=a.trim(o.type)).length>0){if(g&&!g.test(q)){"mime"in k||(k.mime=[]),k.mime.push(p);continue}if(h&&h.test(q)){"mime"in k||(k.mime=[]),k.mime.push(p);continue}}i&&o.size>i?("size"in k||(k.size=[]),k.size.push(p)):j.push(o)}else j.push(o)}else"ext"in k||(k.ext=[]),k.ext.push(p)}if(j.length==b.length)return b;var r={ext:0,mime:0,size:0};"ext"in k&&(r.ext=k.ext.length),"mime"in k&&(r.mime=k.mime.length),"size"in k&&(r.size=k.size.length);var s;return this.$element.trigger(s=new a.Event("file.error.ace"),{file_count:b.length,invalid_count:b.length-j.length,error_list:k,error_count:r,dropped:c}),s.isDefaultPrevented()?-1:j};a.fn.ace_file_input=function(c,d){var e,f=this.each(function(){var b=a(this),f=b.data("ace_file_input"),h="object"==typeof c&&c;f||b.data("ace_file_input",f=new g(this,h)),"string"==typeof c&&(e=f[c](d))});return e===b?f:e},a.fn.ace_file_input.defaults={style:!1,no_file:"No File ...",no_icon:"fa fa-upload",btn_choose:"Choose",btn_change:"Change",icon_remove:"fa fa-times",droppable:!1,thumbnail:!1,allowExt:null,denyExt:null,allowMime:null,denyMime:null,maxSize:!1,before_change:null,before_remove:null,preview_error:null}}(window.jQuery);