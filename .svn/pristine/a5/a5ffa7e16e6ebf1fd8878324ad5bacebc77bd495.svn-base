/*! emomoBms 2017-02-10 */
var express=require("express"),router=express.Router(),fs=require("fs"),func=require("../core/func"),logger=require("../core/util/logger"),rest=require("../core/restUrl"),utils=require("../core/util/utils"),http=require("../core/util/http"),httpClient=require("../core/util/httpClient").DHttpUtil,sd=require("silly-datetime"),restFulPotion={host:rest.urls["emomo-yunkong"].host,port:rest.urls["emomo-yunkong"].port,postType:"json"},restFulConf=rest.urls["emomo-yunkong"],PAGE_SIZE=10;router.get("/page",function(a,b,c){restFulPotion.path=restFulConf.findDeviceTypePage,params=a.query,console.log(params),searchKey=utils.filterParams(params,["typeNum","typeName","brand","factoryName"]),currentPage=""==params.currentPage?1:params.currentPage,restFulPotion.body=JSON.stringify({currentPage:currentPage,pageSize:PAGE_SIZE,keywords:searchKey}),http.doPost(restFulPotion,function(c,d){void 0!=d&&200==c?(d.PRO_MENU={menu:"device",subMenu:"deviceTypePage"},b.render("deviceTypePage",d)):utils.pageMessage(a,b,d.mes,"/deviceType/page","device","deviceTypePage")})}),router.get("/add",function(a,b,c){var d={host:rest.urls["emomo-usersystem"].host,port:rest.urls["emomo-usersystem"].port,postType:"json"};d.path=rest.urls["emomo-usersystem"].allUserByRole+"/FACTORY_ADMIN",http.doGet(d,function(c,d){void 0!=d&&200==c&&"0"==d.code?(d.PRO_MENU={menu:"device",subMenu:"deviceTypePage"},b.render("deviceTypeAddPage",d)):utils.pageMessage(a,b,d.mes,"/deviceType/page","device","deviceTypePage")})}),router.post("/add",function(a,b,c){restFulPotion.path=restFulConf.addDeviceType,params=a.body,data={},data.typeNum=params.typeNum,data.typeName=params.typeName,data.brand=params.brand,data.factoryRate=params.factoryRate,data.factoryUserId=params.factoryUserId||"",""==data.factoryUserId&&utils.pageMessage(a,b,"请选择厂商","/deviceType/add","device","deviceTypePage"),data.factoryName=params.factoryName,restFulPotion.body=JSON.stringify(data),http.doPost(restFulPotion,function(c,d){void 0!=d&&200==c&&0==d.code?(d.PRO_MENU={menu:"device",subMenu:"deviceTypePage"},utils.pageMessage(a,b,"添加成功","/deviceType/page","device","deviceTypePage")):utils.pageMessage(a,b,d.mes,"/deviceType/page","device","deviceTypePage")})}),router.post("/update",function(a,b,c){params=a.body,id=params.id,void 0!=id&&""!=id||utils.pageMessage(a,b,"请选择要更新的批次记录","/deviceType/page","device","deviceTypePage"),data={},data.id=params.id,data.typeNum=params.typeNum,data.typeName=params.typeName,data.brand=params.brand,data.factoryRate=params.factoryRate,restFulPotion.body=JSON.stringify(data),restFulPotion.path=restFulConf.updateDeviceType,http.doPost(restFulPotion,function(c,d){void 0!=d&&200==c&&0==d.code?utils.pageMessage(a,b,"更新成功","/deviceType/page","device","deviceTypePage"):utils.pageMessage(a,b,d.mes,"/deviceType/page","device","deviceTypePage")})}),router.get("/update",function(a,b,c){params=a.query,id=params.id,void 0!=id&&""!=id||utils.pageMessage(a,b,"请选择要更新的批次记录","/deviceType/page","device","deviceTypePage"),restFulPotion.path=restFulConf.findDeviceTypeById+id,http.doGet(restFulPotion,function(c,d){void 0!=d&&200==c&&0==d.code?(d.PRO_MENU={menu:"device",subMenu:"deviceTypePage"},b.render("deviceTypeUpdatePage",d)):utils.pageMessage(a,b,d.mes,"/deviceType/page","device","deviceTypePage")})}),module.exports=router;