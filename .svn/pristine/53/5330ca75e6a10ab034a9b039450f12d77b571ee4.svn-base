/*! emomoBms 2017-02-10 */
var express=require("express"),router=express.Router(),fs=require("fs"),func=require("../core/func"),logger=require("../core/util/logger"),rest=require("../core/restUrl"),http=require("../core/util/http"),sd=require("silly-datetime"),utils=require("../core/util/utils"),restFulPotion={host:rest.urls["emomo-usersystem"].host,port:rest.urls["emomo-usersystem"].port,postType:"json"},restFulConf=rest.urls["emomo-usersystem"],PAGE_SIZE=10;router.get("/platfrom",function(a,b,c){restParams={path:rest.urls["emomo-yunkong"].findMyUsers,host:rest.urls["emomo-yunkong"].host,port:rest.urls["emomo-yunkong"].port,postType:"json"},params=a.query,currentPage=""==params.currentPage?1:params.currentPage,restParams.body=JSON.stringify({currentPage:currentPage,pageSize:PAGE_SIZE,roleId:"YUNKONG_PLATFORM_ADMIN"}),http.doPost(restParams,function(c,d){void 0!=d&&200==c?(d.PRO_MENU={menu:"superAdmin",subMenu:"platformAdminPage"},b.render("platformAdminPage",d)):utils.pageMessage(a,b,d.mes,"/superAdmin/platform","superAdmin","platformAdminPage")})}),router.get("/platfrom/add",function(a,b,c){data={},data.PRO_MENU={menu:"superAdmin",subMenu:"platformAdminPage"},b.render("platformAdminAddPage",data)}),router.post("/platfrom/add",function(a,b,c){restParams=restFulPotion,restParams.path=restFulConf.addUserPlatFormAdmin,params=a.body,data={},data.roleId="YUNKONG_PLATFORM_ADMIN",data.loginName=params.loginName,data.nickName=params.nickName,data.phone=params.phone,data.password=params.password,data.idNum=params.idNum||"",data.address=params.address||"",restParams.body=JSON.stringify(data),http.doPost(restParams,function(c,d){void 0!=d&&200==c&&"0"==d.code?(d.PRO_MENU={menu:"device",subMenu:"batchPage"},utils.pageMessage(a,b,"添加成功","/super/platform","superAdmin","platformAdminPage")):utils.pageMessage(a,b,d.mes,"/super/platfrom","superAdmin","platformAdminPage")})}),router.get("/proxyAdmin",function(a,b,c){restParams={path:rest.urls["emomo-yunkong"].findMyUsers,host:rest.urls["emomo-yunkong"].host,port:rest.urls["emomo-yunkong"].port,postType:"json"},params=a.query,currentPage=""==params.currentPage?1:params.currentPage,restParams.body=JSON.stringify({currentPage:currentPage,pageSize:PAGE_SIZE,roleId:"INDUSTRY_AGENT"}),http.doPost(restParams,function(c,d){void 0!=d&&200==c?(d.PRO_MENU={menu:"superAdmin",subMenu:"proxyAdminPage"},b.render("proxyAdminPage",d)):utils.pageMessage(a,b,d.mes,"/superAdmin/proxyAdmin","superAdmin","proxyAdminPage")})}),router.get("/proxyAdmin/add",function(a,b,c){data={},data.PRO_MENU={menu:"superAdmin",subMenu:"proxyAdminPage"},b.render("proxyAdminAddPage",data)}),router.post("/proxyAdmin/add",function(a,b,c){restParams=restFulPotion,restParams.path=restFulConf.addUserProxyAdmin,params=a.body,data={},data.roleId="INDUSTRY_AGENT",data.loginName=params.loginName,data.nickName=params.nickName,data.phone=params.phone,data.password=params.password,data.idNum=params.idNum||"",data.address=params.address||"",restParams.body=JSON.stringify(data),http.doPost(restParams,function(c,d){void 0!=d&&200==c&&"0"==d.code?utils.pageMessage(a,b,"添加成功","/super/proxyAdmin","superAdmin","proxyAdminPage"):utils.pageMessage(a,b,d.mes,"/super/proxyAdmin","superAdmin","proxyAdminPage")})}),router.get("/subProxyAdmin",function(a,b,c){var d=a.session.user.role;restParams={path:rest.urls["emomo-yunkong"].findMyUsers,host:rest.urls["emomo-yunkong"].host,port:rest.urls["emomo-yunkong"].port,postType:"json"},params=a.query,currentPage=""==params.currentPage?1:params.currentPage,uid=a.session.user.uid;a.session.user.role;restParams.body=JSON.stringify({currentPage:currentPage,pageSize:PAGE_SIZE,uid:uid,roleId:"CITY_OPERATOR"}),http.doPost(restParams,function(c,e){void 0!=e&&200==c?(e.PRO_MENU={menu:"superAdmin",subMenu:"subProxyAdminPage"},e.role=d,console.log("-------------"),console.log(e),b.render("subProxyAdminPage",e)):utils.pageMessage(a,b,e.mes,"/superAdmin/subProxyAdmin","superAdmin","subProxyAdminPage")})}),router.get("/subProxyAdmin/add",function(a,b,c){console.log("----------------"),console.log(a.session.user.role);var d=a.session.user.role;data={},data.PRO_MENU={menu:"superAdmin",subMenu:"subProxyAdminPage"},"INDUSTRY_AGENT"==d&&(data.PRO_MENU={menu:"superAdmin",subMenu:"add"}),b.render("subProxyAdminAddPage",data)}),router.post("/subProxyAdmin/add",function(a,b,c){restParams=restFulPotion,restParams.path=restFulConf.addSubProxyAdmin,params=a.body,data={},data.roleId="CITY_OPERATOR",data.loginName=params.loginName,data.nickName=params.nickName,data.phone=params.phone,data.password=params.password,data.idNum=params.idNum||"",data.address=params.address||"",uid=a.session.user.uid,data.parentUserId=uid,restParams.body=JSON.stringify(data),http.doPost(restParams,function(c,d){void 0!=d&&200==c&&"0"==d.code?utils.pageMessage(a,b,"添加成功","/super/subProxyAdmin","superAdmin","subProxyAdminPage"):utils.pageMessage(a,b,d.mes,"/super/subProxyAdmin","superAdmin","subProxyAdminPage")})}),router.get("/factoryAdmin",function(a,b,c){restParams={path:rest.urls["emomo-yunkong"].findMyUsers,host:rest.urls["emomo-yunkong"].host,port:rest.urls["emomo-yunkong"].port,postType:"json"},params=a.query,currentPage=""==params.currentPage?1:params.currentPage,restParams.body=JSON.stringify({currentPage:currentPage,pageSize:PAGE_SIZE,roleId:"FACTORY_ADMIN"}),http.doPost(restParams,function(c,d){void 0!=d&&200==c?(d.PRO_MENU={menu:"superAdmin",subMenu:"factoryAdminPage"},b.render("factoryAdminPage",d)):utils.pageMessage(a,b,d.mes,"/superAdmin/factoryAdmin","superAdmin","factoryAdminPage")})}),router.get("/factoryAdmin/add",function(a,b,c){data={},data.PRO_MENU={menu:"superAdmin",subMenu:"factoryAdminPage"},b.render("factoryAdminAddPage",data)}),router.post("/factoryAdmin/add",function(a,b,c){restParams=restFulPotion,restParams.path=restFulConf.addUserFactoryAdmin,params=a.body,data={},data.roleId="FACTORY_ADMIN",data.loginName=params.loginName,data.nickName=params.nickName,data.phone=params.phone,data.password=params.password,data.idNum=params.idNum||"",data.address=params.address||"",restParams.body=JSON.stringify(data),http.doPost(restParams,function(c,d){void 0!=d&&200==c&&"0"==d.code?utils.pageMessage(a,b,"添加成功","/super/factoryAdmin","superAdmin","factoryAdminPage"):utils.pageMessage(a,b,d.mes,"/super/factoryAdmin","superAdmin","factoryAdminPage")})}),router.get("/role",function(a,b,c){var d={PRO_MENU:{menu:"superAdmin",subMenu:"rolePage"},list:[]},e={host:rest.urls["emomo-usersystem"].host,port:rest.urls["emomo-usersystem"].port,path:rest.urls["emomo-usersystem"].findAllRole+"/"+a.session.user.role};http.doGet(e,function(a,c){var e=JSON.toString(c);logger.info(e),"0"==c.code?(d.list=c.data,b.render("rolePage",d)):b.render("rolePage",d)})}),module.exports=router;